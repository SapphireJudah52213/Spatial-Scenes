<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Safari Spatial Illusion</title>
<style>
body,html{margin:0;padding:0;overflow:hidden;background:black;}
video,canvas{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;}
#tap{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:black;color:white;padding:10px 18px;border-radius:10px;}
</style>
</head>
<body>
<div id="tap">Tap to Start</div>
<video id="cam" playsinline></video>
<canvas id="c"></canvas>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.162/build/three.module.js';

const video=document.getElementById('cam');
const canvas=document.getElementById('c');
const tap=document.getElementById('tap');
const ctx2d=canvas.getContext('2d');

let scene,camera,renderer,cube;

// camera start
async function start(){
  tap.style.display='none';
  video.srcObject = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
  await video.play();

  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.01,10);
  renderer=new THREE.WebGLRenderer({canvas,alpha:true});
  renderer.setSize(innerWidth,innerHeight);

  scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

  cube=new THREE.Mesh(
    new THREE.BoxGeometry(0.1,0.1,0.1),
    new THREE.MeshStandardMaterial({color:0xffffff,transparent:true,opacity:0.7})
  );
  cube.position.z=-0.5;
  scene.add(cube);

  requestAnimationFrame(loop);
}

function loop(){
  // draw camera behind
  canvas.width=innerWidth;
  canvas.height=innerHeight;
  ctx2d.drawImage(video,0,0,canvas.width,canvas.height);

  cube.rotation.y+=0.01;
  renderer.render(scene,camera);
  requestAnimationFrame(loop);
}

tap.onclick=start;
</script>
</body>
</html>
